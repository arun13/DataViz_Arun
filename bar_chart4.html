<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Load d3-annotation -->
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.js"></script>

<div id="scene_two"></div>

<script>

  var margin = {top: 20, right: 20, bottom: 70, left: 40},
          width = 1200 - margin.left - margin.right,
          height = 400 - margin.top - margin.bottom;

  // Parse the date / time
  var	parseDate = d3.timeParse("%m/%d/%Y");


  d3.csv("data/owid-covid-data_test.csv", function(error, data) {

    var x = d3.scaleBand()
            .domain(d3.extent(data, function(d) {
              return d.date }))
            .rangeRound([0, width], .05).padding(0.1);

    var y = d3.scaleLinear()
            .domain([0, d3.max(data, function(d) { return +d.new_deaths; })])
            .range([height, 0]);

    var xAxis = d3.axisBottom()
            .scale(x)
            .tickFormat(d3.timeFormat("%b"));

    var yAxis = d3.axisLeft()
            .scale(y)
            .ticks(20);

    var svg = d3.select("#scene_two").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");


    data.forEach(function(d) {
      d.date = parseDate(d.date);
      d.value = +d.new_deaths;
    });

    x.domain(data.map(function(d) { return d.date; }));
    y.domain([0, d3.max(data, function(d) { return d.value; })]);

    svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis.ticks(null).tickSize(0))
            .selectAll("text")
            .style("text-anchor", "middle")
//       .attr("dx", "-.8em")
//       .attr("dy", "-.55em")
//       .attr("transform", "rotate(-90)" );

    svg.append("g")
            .attr("class", "y axis")
            .call(yAxis.ticks(null).tickSize(0))
            .append("text")
            //       .attr("transform", "rotate(-90)")
            .attr("y", 6)
            //       .attr("dy", ".71em")
            .style("text-anchor", "middle")
            .text("Value");

    svg.selectAll("bar")
            .data(data)
            .enter().append("rect")
            .style("fill", function(d){ return d.value < d.target ? '#EF5F67': '#3FC974'})
            .attr("x", function(d) { return x(d.date); })
            .attr("width", x.bandwidth())
            .attr("y", function(d) { return y(d.value); })
            .attr("height", function(d) { return height - y(d.value); });
   /* svg.selectAll("lines")
            .data(data)
            .enter().append("line")
            .style("fill", 'none')
            .attr("x1", function(d) { return x(d.date) + x.bandwidth()+5; })
            .attr("x2", function(d) { return x(d.date)-5; })
            .attr("y1", function(d) { return y(d.target); })
            .attr("y2", function(d) { return y(d.target); })
            .style("stroke-dasharray", [2,2])
            .style("stroke", "#000000")
            .style("stroke-width", 2)*/

  });

</script>

</body>